{"remainingRequest":"D:\\尚硅谷\\uniapp_storage\\tea_backend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\尚硅谷\\uniapp_storage\\tea_backend\\src\\components\\combo\\add.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\尚硅谷\\uniapp_storage\\tea_backend\\src\\components\\combo\\add.vue","mtime":1670920041551},{"path":"D:\\尚硅谷\\uniapp_storage\\tea_backend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667713506232},{"path":"D:\\尚硅谷\\uniapp_storage\\tea_backend\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1667713504236},{"path":"D:\\尚硅谷\\uniapp_storage\\tea_backend\\node_modules\\babel-loader\\lib\\index.js","mtime":1667713515975},{"path":"D:\\尚硅谷\\uniapp_storage\\tea_backend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667713506232},{"path":"D:\\尚硅谷\\uniapp_storage\\tea_backend\\node_modules\\vue-loader\\lib\\index.js","mtime":1667713514172}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n\tquerySetmealById\n} from '../../api/combo.js'\n\nimport {\n\tgetCategoryList\n} from '../../api/food.js'\nimport {\n\taddSetmeal\n} from '../../api/combo.js'\nimport {\n\teditSetmeal\n} from '../../api/combo.js'\nimport {\n\tqueryDishList\n} from '../../api/food.js'\nexport default {\n\tname: 'comboadd',\n\tel: '#combo-add-app',\n\tdata() {\n\t\treturn {\n\t\t\tid: '',\n\t\t\tactionType: '',\n\t\t\tvalue: '',\n\t\t\tsetMealList: [],\n\t\t\tseachKey: '',\n\t\t\tdishList: [],\n\t\t\timageUrl: '',\n\t\t\tactionType: '',\n\t\t\tdishTable: [],\n\t\t\tdialogVisible: false,\n\t\t\tcheckList: [],\n\t\t\truleForm: {\n\t\t\t\tname: '',\n\t\t\t\tcategoryId: '',\n\t\t\t\tprice: '',\n\t\t\t\tcode: '',\n\t\t\t\timage: '',\n\t\t\t\tdescription: '',\n\t\t\t\tdishList: [],\n\t\t\t\tstatus: true,\n\t\t\t\tidType: '',\n\t\t\t},\n\t\t\tdishType: [],\n\t\t\tdishAddList: [],\n\t\t\tdishListCache: [],\n\t\t\tkeyInd: 0,\n\t\t\tsearchValue: '',\n\t\t\tcheckedList: []\n\t\t}\n\t},\n\tcomputed: {\n\t\trules() {\n\t\t\treturn {\n\t\t\t\tname: {\n\t\t\t\t\trequired: true,\n\t\t\t\t\tmessage: '请输入套餐名称',\n\t\t\t\t\ttrigger: 'blur',\n\t\t\t\t},\n\t\t\t\tidType: {\n\t\t\t\t\trequired: true,\n\t\t\t\t\tmessage: '请选择套餐分类',\n\t\t\t\t\ttrigger: 'change',\n\t\t\t\t},\n\t\t\t\tprice: {\n\t\t\t\t\trequired: true,\n\t\t\t\t\t// 'message': '请输入套餐价格',\n\t\t\t\t\tvalidator: (rules, value, callback) => {\n\t\t\t\t\t\tif (!value) {\n\t\t\t\t\t\t\tcallback(new Error('请填写菜品价格'))\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst reg = /^\\d+(\\.\\d{0,2})?$/\n\t\t\t\t\t\t\tif (reg.test(value)) {\n\t\t\t\t\t\t\t\tif (value < 10000) {\n\t\t\t\t\t\t\t\t\tcallback()\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcallback(new Error('菜品价格小于10000'))\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcallback(new Error('菜品价格格式只能为数字,且最多保留两位小数'))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\ttrigger: 'blur',\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tseachKey(value) {\n\t\t\tif (value.trim()) {\n\t\t\t\tthis.getDishForName(this.seachKey)\n\t\t\t}\n\t\t},\n\t\tcheckList(value) {\n\t\t\tthis.checkedList = value\n\t\t}\n\t},\n\tcreated() {\n\t\t\tthis.$parent.goBackFlag=true;\n\t\t\tthis.$parent.menuActived='5'\n\t\tthis.getDishTypeList()\n\t\tthis.getDishType()\n\t\tthis.id = this.$route.params.id\n\t\tconsole.log(this.id)\n\t\tthis.actionType = this.id ? 'edit' : 'add'\n\t\tif (this.id) {\n\t\t\tthis.init()\n\t\t}\n\t},\n\tmounted() {},\n\tmethods: {\n\t\tasync init() {\n\t\t\tquerySetmealById(this.id).then((res) => {\n\t\t\t\tconsole.log(res)\n\t\t\t\tif (String(res.data.code) === '1') {\n\t\t\t\t\tthis.ruleForm = res.data.data\n\t\t\t\t\tthis.ruleForm.status = res.data.data.status === '1'\n\t\t\t\t\tthis.ruleForm.price = res.data.data.price \n\t\t\t\t\tthis.imageUrl = `/api/common/download?name=${res.data.data.image}`\n\t\t\t\t\tthis.checkList = res.data.data.setmealDishes\n\t\t\t\t\tconsole.log(\"**********************************\")\n\t\t\t\t\tconsole.log(this.checkList)\n\t\t\t\t\tthis.dishTable = res.data.data.setmealDishes\n\t\t\t\t\tthis.ruleForm.idType = res.data.data.categoryId\n\t\t\t\t\t// this.ruleForm.password = ''\n\t\t\t\t} else {\n\t\t\t\t\tthis.$message.error(res.data.msg || '操作失败')\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tseachHandle() {\n\t\t\tthis.seachKey = this.value\n\t\t},\n\t\t// 获取套餐分类\n\t\tgetDishTypeList() {\n\t\t\tgetCategoryList({\n\t\t\t\ttype: 2,\n\t\t\t\tpage: 1,\n\t\t\t\tpageSize: 1000\n\t\t\t}).then((res) => {\n\t\t\t\tif (res.data.code === 1) {\n\t\t\t\t\tthis.setMealList = res.data.data.map((obj) => ({\n\t\t\t\t\t\t...obj,\n\t\t\t\t\t\tidType: obj.id\n\t\t\t\t\t}))\n\t\t\t\t} else {\n\t\t\t\t\tthis.$message.error(res.data.msg || '操作失败')\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\t// 删除套餐菜品\n\t\tdelDishHandle(index) {\n\t\t\tthis.dishTable.splice(index, 1)\n\t\t\tthis.checkList.splice(index, 1)\n\t\t},\n\n\t\t// 获取添加菜品数据\n\t\tgetCheckList(value) {\n\t\t\tthis.checkList = [...value]\n\t\t},\n\n\t\t// 添加菜品\n\t\topenAddDish() {\n\t\t\tthis.seachKey = ''\n\t\t\tthis.dialogVisible = true\n\t\t\t//搜索条件清空，菜品重新查询，菜品类别选第一个重新查询\n\t\t\tthis.value = ''\n\t\t\tthis.keyInd = 0\n\t\t\tthis.getDishList(this.dishType[0].id)\n\t\t},\n\t\t// 取消添加菜品\n\t\thandleClose(done) {\n\t\t\t// this.$refs.adddish.close()\n\t\t\tthis.dialogVisible = false\n\t\t\t// this.checkList = JSON.parse(JSON.stringify(this.dishTable))\n\t\t\t// this.dialogVisible = false\n\t\t},\n\n\t\t// 保存添加菜品列表\n\t\taddTableList() {\n\t\t\tthis.dishTable = JSON.parse(JSON.stringify(this.checkList))\n\t\t\tthis.dishTable.forEach((n) => {\n\t\t\t\tn.copies = 1\n\t\t\t})\n\t\t\tthis.dialogVisible = false\n\t\t\t// 添加处理逻辑清空选中list\n\t\t\tthis.checkList = []\n\t\t},\n\t\tsubmitForm(formName, st) {\n\t\t\tthis.$refs[formName].validate((valid) => {\n\t\t\t\tif (valid) {\n\t\t\t\t\tlet prams = {\n\t\t\t\t\t\t...this.ruleForm\n\t\t\t\t\t}\n\t\t\t\t\t// prams.price *= 100\n\t\t\t\t\tprams.setmealDishes = this.dishTable.map((obj) => ({\n\t\t\t\t\t\tcopies: obj.copies,\n\t\t\t\t\t\tdishId: obj.dishId,\n\t\t\t\t\t\tname: obj.name,\n\t\t\t\t\t\tprice: obj.price,\n\t\t\t\t\t}))\n\t\t\t\t\tprams.status = this.ruleForm ? 1 : 0\n\t\t\t\t\tprams.categoryId = this.ruleForm.idType\n\t\t\t\t\tif (prams.setmealDishes.length < 1) {\n\t\t\t\t\t\tthis.$message.error('请选择菜品！')\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.imageUrl) {\n\t\t\t\t\t\tthis.$message.error('请上传套餐图片')\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\t// delete prams.dishList\n\t\t\t\t\tif (this.actionType == 'add') {\n\t\t\t\t\t\tdelete prams.id\n\t\t\t\t\t\taddSetmeal(prams)\n\t\t\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\t\t\tif (res.data.code === 1) {\n\t\t\t\t\t\t\t\t\tthis.$message.success('套餐添加成功！')\n\t\t\t\t\t\t\t\t\tif (!st) {\n\t\t\t\t\t\t\t\t\t\tthis.goBack()\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tthis.$refs.ruleForm.resetFields()\n\t\t\t\t\t\t\t\t\t\tthis.dishList = []\n\t\t\t\t\t\t\t\t\t\tthis.dishTable = []\n\t\t\t\t\t\t\t\t\t\tthis.ruleForm = {\n\t\t\t\t\t\t\t\t\t\t\tname: '',\n\t\t\t\t\t\t\t\t\t\t\tcategoryId: '',\n\t\t\t\t\t\t\t\t\t\t\tprice: '',\n\t\t\t\t\t\t\t\t\t\t\tcode: '',\n\t\t\t\t\t\t\t\t\t\t\timage: '',\n\t\t\t\t\t\t\t\t\t\t\tdescription: '',\n\t\t\t\t\t\t\t\t\t\t\tdishList: [],\n\t\t\t\t\t\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\t\t\t\t\t\tid: '',\n\t\t\t\t\t\t\t\t\t\t\tidType: '',\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tthis.imageUrl = ''\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.$message.error(res.data.msg || '操作失败')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\t\tthis.$message.error('请求出错了：' + err)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete prams.updateTime\n\t\t\t\t\t\teditSetmeal(prams)\n\t\t\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\t\t\tif (res.data.code === 1) {\n\t\t\t\t\t\t\t\t\tthis.$message.success('套餐修改成功！')\n\t\t\t\t\t\t\t\t\tthis.goBack()\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.$message.error(res.data.msg || '操作失败')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\t\tthis.$message.error('请求出错了：' + err)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\thandleAvatarSuccess(response, file, fileList) {\n\t\t\t// this.imageUrl = response.data\n\t\t\tif (response.code === 0 && response.msg === '未登录') {\n\t\t\t\twindow.top.location.href = '/backend/page/login/login.html'\n\t\t\t} else {\n\t\t\t\tthis.imageUrl = `/api/common/download?name=${response.data}`\n\t\t\t\tthis.ruleForm.image = response.data\n\t\t\t}\n\t\t},\n\n\t\tonChange(file) {\n\t\t\tif (file) {\n\t\t\t\tconst suffix = file.name.split('.')[1]\n\t\t\t\tconst size = file.size / 1024 / 1024 < 2\n\t\t\t\tif (['png', 'jpeg', 'jpg'].indexOf(suffix) < 0) {\n\t\t\t\t\tthis.$message.error('上传图片只支持 png、jpeg、jpg 格式！')\n\t\t\t\t\tthis.$refs.upload.clearFiles()\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\tif (!size) {\n\t\t\t\t\tthis.$message.error('上传文件大小不能超过 2MB!')\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\treturn file\n\t\t\t}\n\t\t},\n\t\tgoBack() {\n\t\t\tthis.$router.push('/combo/list')\n\t\t},\n\t\t// 获取套餐分类\n\t\tgetDishType() {\n\t\t\tgetCategoryList({\n\t\t\t\t'type': 1\n\t\t\t}).then(res => {\n\t\t\t\tif (res.data.code === 1) {\n\t\t\t\t\tthis.dishType = res.data.data\n\t\t\t\t\tthis.getDishList(res.data.data[0].id)\n\t\t\t\t} else {\n\t\t\t\t\tthis.$message.error(res.data.msg)\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\n\t\t// 通过套餐ID获取菜品列表分类\n\t\tgetDishList(id) {\n\t\t\tqueryDishList({\n\t\t\t\tcategoryId: id\n\t\t\t}).then(res => {\n\t\t\t\tif (res.data.code === 1) {\n\t\t\t\t\tif (res.data.data.length == 0) {\n\t\t\t\t\t\tthis.dishAddList = []\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tlet newArr = res.data.data;\n\t\t\t\t\tnewArr.forEach((n) => {\n\t\t\t\t\t\tn.dishId = n.id\n\t\t\t\t\t\tn.copies = 1\n\t\t\t\t\t\t// n.dishCopies = 1\n\t\t\t\t\t\tn.dishName = n.name\n\t\t\t\t\t})\n\t\t\t\t\tthis.dishAddList = newArr\n\t\t\t\t} else {\n\t\t\t\t\tthis.$message.error(res.data.msg)\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\n\t\t// 关键词收搜菜品列表分类\n\t\tgetDishForName(name) {\n\t\t\tqueryDishList({\n\t\t\t\tname\n\t\t\t}).then(res => {\n\t\t\t\tif (res.data.code === 1) {\n\t\t\t\t\tlet newArr = res.data.data\n\t\t\t\t\tnewArr.forEach((n) => {\n\t\t\t\t\t\tn.dishId = n.id\n\t\t\t\t\t\tn.dishName = n.name\n\t\t\t\t\t})\n\t\t\t\t\tthis.dishAddList = newArr\n\t\t\t\t} else {\n\t\t\t\t\tthis.$message.error(res.data.msg)\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\n\t\tcheckTypeHandle(ind, id) {\n\t\t\tthis.keyInd = ind\n\t\t\tthis.getDishList(id)\n\t\t},\n\n\t\tcheckedListHandle(value) {\n\t\t\tthis.getCheckList(this.checkedList)\n\t\t},\n\n\t\topen(done) {\n\t\t\tthis.dishListCache = JSON.parse(JSON.stringify(this.checkList))\n\t\t},\n\n\t\tclose(done) {\n\t\t\tthis.checkList = this.dishListCache\n\t\t},\n\n\t\t// 删除\n\t\tdelCheck(ind) {\n\t\t\tthis.checkedList.splice(ind, 1)\n\t\t}\n\t},\n}\n",{"version":3,"sources":["add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2JA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"add.vue","sourceRoot":"src/components/combo","sourcesContent":["<template>\r\n\t<div class=\"addBrand-container\" id=\"combo-add-app\">\r\n\t\t<div class=\"container\" style=\"height:600px; overflow:auto\">\r\n\t\t\t<el-form ref=\"ruleForm\" :model=\"ruleForm\" :rules=\"rules\" :inline=\"true\" label-width=\"180px\"\r\n\t\t\t\tclass=\"demo-ruleForm\">\r\n\t\t\t\t<div style=\"width: 90%;display: flex;\">\r\n\t\t\t\t\t<el-form-item label=\"套餐名称:\" prop=\"name\" style=\"width: 50%;\">\r\n\t\t\t\t\t\t<el-input v-model=\"ruleForm.name\" placeholder=\"请填写套餐名称\" maxlength=\"20\" />\r\n\t\t\t\t\t</el-form-item>\r\n\t\t\t\t\t<el-form-item label=\"套餐分类:\" prop=\"idType\" style=\"width: 50%;\">\r\n\t\t\t\t\t\t<el-select v-model=\"ruleForm.idType\" placeholder=\"请选择套餐分类\" @change=\"$forceUpdate()\">\r\n\t\t\t\t\t\t\t<el-option v-for=\"(item, index) in setMealList\" :key=\"index\" :label=\"item.name\"\r\n\t\t\t\t\t\t\t\t:value=\"item.id\" />\r\n\t\t\t\t\t\t</el-select>\r\n\t\t\t\t\t</el-form-item>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"width: 90%;display: flex\">\r\n\t\t\t\t\t<div style=\"width: 50%;margin-right: auto;\">\r\n\t\t\t\t\t\t<el-form-item label=\"套餐价格:\" prop=\"price\">\r\n\t\t\t\t\t\t\t<el-input v-model=\"ruleForm.price\" placeholder=\"请设置套餐价格\" />\r\n\t\t\t\t\t\t</el-form-item>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"width: 90%;display: flex;\">\r\n\t\t\t\t\t<div style=\"width: 50%;margin-right: auto;\">\r\n\t\t\t\t\t\t<el-form-item label=\"套餐菜品:\" class=\"setmealFood\">\r\n\t\t\t\t\t\t\t<el-form-item>\r\n\t\t\t\t\t\t\t\t<div class=\"addDish\">\r\n\t\t\t\t\t\t\t\t\t<span v-if=\"dishTable.length == 0\" class=\"addBut\" @click=\"openAddDish\"\r\n\t\t\t\t\t\t\t\t\t\tstyle=\"float: left;\"> +\r\n\t\t\t\t\t\t\t\t\t\t添加菜品</span>\r\n\t\t\t\t\t\t\t\t\t<div v-if=\"dishTable.length != 0\" class=\"content\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"addBut\" style=\"margin-bottom: 20px\" @click=\"openAddDish\">+ 添加菜品\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"table\">\r\n\t\t\t\t\t\t\t\t\t\t\t<el-table :data=\"dishTable\" style=\"width: 100%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<el-table-column prop=\"name\" label=\"名称\" width=\"180\" align=\"center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t</el-table-column>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<el-table-column prop=\"price\" label=\"原价\" width=\"180\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template slot-scope=\"scope\"> {{ Number(scope.row.price)  }}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</el-table-column>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<el-table-column prop=\"address\" label=\"份数\" align=\"center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<el-input-number v-model=\"scope.row.copies\" size=\"small\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t:min=\"1\" :max=\"99\" label=\"描述文字\"></el-input-number>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</el-table-column>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<el-table-column prop=\"address\" label=\"操作\" width=\"180px;\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\talign=\"center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<el-button type=\"text\" size=\"small\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t@click=\"delDishHandle(scope.$index)\"> 删除 </el-button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</el-table-column>\r\n\t\t\t\t\t\t\t\t\t\t\t</el-table>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</el-form-item>\r\n\t\t\t\t\t\t</el-form-item>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"width: 90%;display: flex;\">\r\n\t\t\t\t\t<div style=\"width: 50%;margin-right: auto;\">\r\n\t\t\t\t\t\t<el-form-item label=\"套餐图片:\" class=\"uploadImg\">\r\n\t\t\t\t\t\t\t<el-upload class=\"avatar-uploader\" action=\"/api/common/upload\" :show-file-list=\"false\"\r\n\t\t\t\t\t\t\t\t:on-success=\"handleAvatarSuccess\" :on-change=\"onChange\" ref=\"upload\"\r\n\t\t\t\t\t\t\t\tstyle=\"float: left;\">\r\n\t\t\t\t\t\t\t\t<img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\"></img>\r\n\t\t\t\t\t\t\t\t<i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n\t\t\t\t\t\t\t</el-upload>\r\n\t\t\t\t\t\t</el-form-item>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"address\" style=\"width:84%;\">\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<el-form-item label=\"套餐描述:\">\r\n\t\t\t\t\t\t\t<el-input v-model=\"ruleForm.description\" type=\"textarea\" :rows=\"3\" placeholder=\"套餐描述，最长200字\"\r\n\t\t\t\t\t\t\t\tmaxlength=\"200\" />\r\n\t\t\t\t\t\t</el-form-item>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"subBox address\">\r\n\t\t\t\t\t<el-form-item>\r\n\t\t\t\t\t\t<el-button @click=\"goBack()\"> 取消 </el-button>\r\n\t\t\t\t\t\t<el-button type=\"primary\" @click=\"submitForm('ruleForm', false)\"> 保存 </el-button>\r\n\t\t\t\t\t\t<el-button v-if=\"actionType == 'add'\" type=\"primary\" class=\"continue\"\r\n\t\t\t\t\t\t\t@click=\"submitForm('ruleForm', true)\">\r\n\t\t\t\t\t\t\t保存并继续添加套餐\r\n\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t</el-form-item>\r\n\t\t\t\t</div>\r\n\t\t\t</el-form>\r\n\t\t</div>\r\n\t\t<el-dialog title=\"添加菜品\" class=\"addDishList\" :visible.sync=\"dialogVisible\" width=\"60%\"\r\n\t\t\t:before-close=\"handleClose\">\r\n\t\t\t<el-input v-model=\"value\" class=\"seachDish\" placeholder=\"请输入菜品名称进行搜索\" style=\"width: 250px\" size=\"small\"\r\n\t\t\t\tclearable>\r\n\t\t\t\t<i slot=\"prefix\" class=\"el-input__icon el-icon-search\" style=\"cursor: pointer\" @click=\"seachHandle\"></i>\r\n\t\t\t</el-input>\r\n\t\t\t<!-- <AddDish ref=\"adddish\" :check-list=\"checkList\" :seach-key=\"seachKey\" @checkList=\"getCheckList\" /> -->\r\n\r\n\t\t\t<div class=\"addDishCon\">\r\n\t\t\t\t<div class=\"leftCont\">\r\n\t\t\t\t\t<div v-show=\"seachKey.trim() == ''\" class=\"tabBut\">\r\n\t\t\t\t\t\t<span v-for=\"(item, index) in dishType\" :key=\"index\" :class=\"{act:index == keyInd}\"\r\n\t\t\t\t\t\t\t@click=\"checkTypeHandle(index, item.id)\">{{ item.name }}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"tabList\">\r\n\t\t\t\t\t\t<div class=\"table\">\r\n\t\t\t\t\t\t\t<div v-if=\"dishAddList.length == 0\" style=\"padding-left:10px\">\r\n\t\t\t\t\t\t\t\t暂无菜品!\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<el-checkbox-group v-if=\"dishAddList.length > 0\" v-model=\"checkedList\"\r\n\t\t\t\t\t\t\t\t@change=\"checkedListHandle\">\r\n\t\t\t\t\t\t\t\t<div v-for=\"(item, index) in dishAddList\" :key=\"index\" class=\"items\">\r\n\t\t\t\t\t\t\t\t\t<el-checkbox :key=\"index\" :label=\"item\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"item\"\r\n\t\t\t\t\t\t\t\t\t\t\tstyle=\"display: flex;width: 220px;\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span style=\"width: 80%;text-align: left;\">{{ item.dishName }}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span style=\" width: 10%;text-align: right;\">{{ item.status == 0 ? '停售' : '在售' }}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span style=\"width: 10%;text-align: right;\">{{ Number(item.price) }}</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</el-checkbox>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</el-checkbox-group>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ritCont\">\r\n\t\t\t\t\t<div class=\"tit\">\r\n\t\t\t\t\t\t已选菜品({{ checkedList.length }})\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"items\">\r\n\t\t\t\t\t\t<div v-for=\"(item, ind) in checkedList\" :key=\"ind\" class=\"item\">\r\n\t\t\t\t\t\t\t<span>{{ item.name }}</span>\r\n\t\t\t\t\t\t\t<span class=\"price\">￥ {{ Number(item.price) }} </span>\r\n\t\t\t\t\t\t\t<span class=\"del\" @click=\"delCheck(ind)\">\r\n\t\t\t\t\t\t\t\t<img src=\"../../assets/icon/btn_clean@2x.png\" alt=\"\">\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<span slot=\"footer\" class=\"dialog-footer\">\r\n\t\t\t\t<el-button @click=\"handleClose\">取 消</el-button>\r\n\t\t\t\t<el-button type=\"primary\" @click=\"addTableList\">确 定</el-button>\r\n\t\t\t</span>\r\n\t\t</el-dialog>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tquerySetmealById\r\n\t} from '../../api/combo.js'\r\n\r\n\timport {\r\n\t\tgetCategoryList\r\n\t} from '../../api/food.js'\r\n\timport {\r\n\t\taddSetmeal\r\n\t} from '../../api/combo.js'\r\n\timport {\r\n\t\teditSetmeal\r\n\t} from '../../api/combo.js'\r\n\timport {\r\n\t\tqueryDishList\r\n\t} from '../../api/food.js'\r\n\texport default {\r\n\t\tname: 'comboadd',\r\n\t\tel: '#combo-add-app',\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tid: '',\r\n\t\t\t\tactionType: '',\r\n\t\t\t\tvalue: '',\r\n\t\t\t\tsetMealList: [],\r\n\t\t\t\tseachKey: '',\r\n\t\t\t\tdishList: [],\r\n\t\t\t\timageUrl: '',\r\n\t\t\t\tactionType: '',\r\n\t\t\t\tdishTable: [],\r\n\t\t\t\tdialogVisible: false,\r\n\t\t\t\tcheckList: [],\r\n\t\t\t\truleForm: {\r\n\t\t\t\t\tname: '',\r\n\t\t\t\t\tcategoryId: '',\r\n\t\t\t\t\tprice: '',\r\n\t\t\t\t\tcode: '',\r\n\t\t\t\t\timage: '',\r\n\t\t\t\t\tdescription: '',\r\n\t\t\t\t\tdishList: [],\r\n\t\t\t\t\tstatus: true,\r\n\t\t\t\t\tidType: '',\r\n\t\t\t\t},\r\n\t\t\t\tdishType: [],\r\n\t\t\t\tdishAddList: [],\r\n\t\t\t\tdishListCache: [],\r\n\t\t\t\tkeyInd: 0,\r\n\t\t\t\tsearchValue: '',\r\n\t\t\t\tcheckedList: []\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\trules() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: {\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmessage: '请输入套餐名称',\r\n\t\t\t\t\t\ttrigger: 'blur',\r\n\t\t\t\t\t},\r\n\t\t\t\t\tidType: {\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmessage: '请选择套餐分类',\r\n\t\t\t\t\t\ttrigger: 'change',\r\n\t\t\t\t\t},\r\n\t\t\t\t\tprice: {\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\t// 'message': '请输入套餐价格',\r\n\t\t\t\t\t\tvalidator: (rules, value, callback) => {\r\n\t\t\t\t\t\t\tif (!value) {\r\n\t\t\t\t\t\t\t\tcallback(new Error('请填写菜品价格'))\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconst reg = /^\\d+(\\.\\d{0,2})?$/\r\n\t\t\t\t\t\t\t\tif (reg.test(value)) {\r\n\t\t\t\t\t\t\t\t\tif (value < 10000) {\r\n\t\t\t\t\t\t\t\t\t\tcallback()\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tcallback(new Error('菜品价格小于10000'))\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcallback(new Error('菜品价格格式只能为数字,且最多保留两位小数'))\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\ttrigger: 'blur',\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tseachKey(value) {\r\n\t\t\t\tif (value.trim()) {\r\n\t\t\t\t\tthis.getDishForName(this.seachKey)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcheckList(value) {\r\n\t\t\t\tthis.checkedList = value\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\t\tthis.$parent.goBackFlag=true;\r\n\t\t\t\tthis.$parent.menuActived='5'\r\n\t\t\tthis.getDishTypeList()\r\n\t\t\tthis.getDishType()\r\n\t\t\tthis.id = this.$route.params.id\r\n\t\t\tconsole.log(this.id)\r\n\t\t\tthis.actionType = this.id ? 'edit' : 'add'\r\n\t\t\tif (this.id) {\r\n\t\t\t\tthis.init()\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {},\r\n\t\tmethods: {\r\n\t\t\tasync init() {\r\n\t\t\t\tquerySetmealById(this.id).then((res) => {\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tif (String(res.data.code) === '1') {\r\n\t\t\t\t\t\tthis.ruleForm = res.data.data\r\n\t\t\t\t\t\tthis.ruleForm.status = res.data.data.status === '1'\r\n\t\t\t\t\t\tthis.ruleForm.price = res.data.data.price \r\n\t\t\t\t\t\tthis.imageUrl = `/api/common/download?name=${res.data.data.image}`\r\n\t\t\t\t\t\tthis.checkList = res.data.data.setmealDishes\r\n\t\t\t\t\t\tconsole.log(\"**********************************\")\r\n\t\t\t\t\t\tconsole.log(this.checkList)\r\n\t\t\t\t\t\tthis.dishTable = res.data.data.setmealDishes\r\n\t\t\t\t\t\tthis.ruleForm.idType = res.data.data.categoryId\r\n\t\t\t\t\t\t// this.ruleForm.password = ''\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$message.error(res.data.msg || '操作失败')\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tseachHandle() {\r\n\t\t\t\tthis.seachKey = this.value\r\n\t\t\t},\r\n\t\t\t// 获取套餐分类\r\n\t\t\tgetDishTypeList() {\r\n\t\t\t\tgetCategoryList({\r\n\t\t\t\t\ttype: 2,\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tpageSize: 1000\r\n\t\t\t\t}).then((res) => {\r\n\t\t\t\t\tif (res.data.code === 1) {\r\n\t\t\t\t\t\tthis.setMealList = res.data.data.map((obj) => ({\r\n\t\t\t\t\t\t\t...obj,\r\n\t\t\t\t\t\t\tidType: obj.id\r\n\t\t\t\t\t\t}))\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$message.error(res.data.msg || '操作失败')\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 删除套餐菜品\r\n\t\t\tdelDishHandle(index) {\r\n\t\t\t\tthis.dishTable.splice(index, 1)\r\n\t\t\t\tthis.checkList.splice(index, 1)\r\n\t\t\t},\r\n\r\n\t\t\t// 获取添加菜品数据\r\n\t\t\tgetCheckList(value) {\r\n\t\t\t\tthis.checkList = [...value]\r\n\t\t\t},\r\n\r\n\t\t\t// 添加菜品\r\n\t\t\topenAddDish() {\r\n\t\t\t\tthis.seachKey = ''\r\n\t\t\t\tthis.dialogVisible = true\r\n\t\t\t\t//搜索条件清空，菜品重新查询，菜品类别选第一个重新查询\r\n\t\t\t\tthis.value = ''\r\n\t\t\t\tthis.keyInd = 0\r\n\t\t\t\tthis.getDishList(this.dishType[0].id)\r\n\t\t\t},\r\n\t\t\t// 取消添加菜品\r\n\t\t\thandleClose(done) {\r\n\t\t\t\t// this.$refs.adddish.close()\r\n\t\t\t\tthis.dialogVisible = false\r\n\t\t\t\t// this.checkList = JSON.parse(JSON.stringify(this.dishTable))\r\n\t\t\t\t// this.dialogVisible = false\r\n\t\t\t},\r\n\r\n\t\t\t// 保存添加菜品列表\r\n\t\t\taddTableList() {\r\n\t\t\t\tthis.dishTable = JSON.parse(JSON.stringify(this.checkList))\r\n\t\t\t\tthis.dishTable.forEach((n) => {\r\n\t\t\t\t\tn.copies = 1\r\n\t\t\t\t})\r\n\t\t\t\tthis.dialogVisible = false\r\n\t\t\t\t// 添加处理逻辑清空选中list\r\n\t\t\t\tthis.checkList = []\r\n\t\t\t},\r\n\t\t\tsubmitForm(formName, st) {\r\n\t\t\t\tthis.$refs[formName].validate((valid) => {\r\n\t\t\t\t\tif (valid) {\r\n\t\t\t\t\t\tlet prams = {\r\n\t\t\t\t\t\t\t...this.ruleForm\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// prams.price *= 100\r\n\t\t\t\t\t\tprams.setmealDishes = this.dishTable.map((obj) => ({\r\n\t\t\t\t\t\t\tcopies: obj.copies,\r\n\t\t\t\t\t\t\tdishId: obj.dishId,\r\n\t\t\t\t\t\t\tname: obj.name,\r\n\t\t\t\t\t\t\tprice: obj.price,\r\n\t\t\t\t\t\t}))\r\n\t\t\t\t\t\tprams.status = this.ruleForm ? 1 : 0\r\n\t\t\t\t\t\tprams.categoryId = this.ruleForm.idType\r\n\t\t\t\t\t\tif (prams.setmealDishes.length < 1) {\r\n\t\t\t\t\t\t\tthis.$message.error('请选择菜品！')\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!this.imageUrl) {\r\n\t\t\t\t\t\t\tthis.$message.error('请上传套餐图片')\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// delete prams.dishList\r\n\t\t\t\t\t\tif (this.actionType == 'add') {\r\n\t\t\t\t\t\t\tdelete prams.id\r\n\t\t\t\t\t\t\taddSetmeal(prams)\r\n\t\t\t\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\t\t\t\tif (res.data.code === 1) {\r\n\t\t\t\t\t\t\t\t\t\tthis.$message.success('套餐添加成功！')\r\n\t\t\t\t\t\t\t\t\t\tif (!st) {\r\n\t\t\t\t\t\t\t\t\t\t\tthis.goBack()\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tthis.$refs.ruleForm.resetFields()\r\n\t\t\t\t\t\t\t\t\t\t\tthis.dishList = []\r\n\t\t\t\t\t\t\t\t\t\t\tthis.dishTable = []\r\n\t\t\t\t\t\t\t\t\t\t\tthis.ruleForm = {\r\n\t\t\t\t\t\t\t\t\t\t\t\tname: '',\r\n\t\t\t\t\t\t\t\t\t\t\t\tcategoryId: '',\r\n\t\t\t\t\t\t\t\t\t\t\t\tprice: '',\r\n\t\t\t\t\t\t\t\t\t\t\t\tcode: '',\r\n\t\t\t\t\t\t\t\t\t\t\t\timage: '',\r\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: '',\r\n\t\t\t\t\t\t\t\t\t\t\t\tdishList: [],\r\n\t\t\t\t\t\t\t\t\t\t\t\tstatus: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\tid: '',\r\n\t\t\t\t\t\t\t\t\t\t\t\tidType: '',\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tthis.imageUrl = ''\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tthis.$message.error(res.data.msg || '操作失败')\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch((err) => {\r\n\t\t\t\t\t\t\t\t\tthis.$message.error('请求出错了：' + err)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdelete prams.updateTime\r\n\t\t\t\t\t\t\teditSetmeal(prams)\r\n\t\t\t\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\t\t\t\tif (res.data.code === 1) {\r\n\t\t\t\t\t\t\t\t\t\tthis.$message.success('套餐修改成功！')\r\n\t\t\t\t\t\t\t\t\t\tthis.goBack()\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tthis.$message.error(res.data.msg || '操作失败')\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch((err) => {\r\n\t\t\t\t\t\t\t\t\tthis.$message.error('请求出错了：' + err)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\thandleAvatarSuccess(response, file, fileList) {\r\n\t\t\t\t// this.imageUrl = response.data\r\n\t\t\t\tif (response.code === 0 && response.msg === '未登录') {\r\n\t\t\t\t\twindow.top.location.href = '/backend/page/login/login.html'\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.imageUrl = `/api/common/download?name=${response.data}`\r\n\t\t\t\t\tthis.ruleForm.image = response.data\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tonChange(file) {\r\n\t\t\t\tif (file) {\r\n\t\t\t\t\tconst suffix = file.name.split('.')[1]\r\n\t\t\t\t\tconst size = file.size / 1024 / 1024 < 2\r\n\t\t\t\t\tif (['png', 'jpeg', 'jpg'].indexOf(suffix) < 0) {\r\n\t\t\t\t\t\tthis.$message.error('上传图片只支持 png、jpeg、jpg 格式！')\r\n\t\t\t\t\t\tthis.$refs.upload.clearFiles()\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!size) {\r\n\t\t\t\t\t\tthis.$message.error('上传文件大小不能超过 2MB!')\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn file\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgoBack() {\r\n\t\t\t\tthis.$router.push('/combo/list')\r\n\t\t\t},\r\n\t\t\t// 获取套餐分类\r\n\t\t\tgetDishType() {\r\n\t\t\t\tgetCategoryList({\r\n\t\t\t\t\t'type': 1\r\n\t\t\t\t}).then(res => {\r\n\t\t\t\t\tif (res.data.code === 1) {\r\n\t\t\t\t\t\tthis.dishType = res.data.data\r\n\t\t\t\t\t\tthis.getDishList(res.data.data[0].id)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$message.error(res.data.msg)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\r\n\t\t\t// 通过套餐ID获取菜品列表分类\r\n\t\t\tgetDishList(id) {\r\n\t\t\t\tqueryDishList({\r\n\t\t\t\t\tcategoryId: id\r\n\t\t\t\t}).then(res => {\r\n\t\t\t\t\tif (res.data.code === 1) {\r\n\t\t\t\t\t\tif (res.data.data.length == 0) {\r\n\t\t\t\t\t\t\tthis.dishAddList = []\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet newArr = res.data.data;\r\n\t\t\t\t\t\tnewArr.forEach((n) => {\r\n\t\t\t\t\t\t\tn.dishId = n.id\r\n\t\t\t\t\t\t\tn.copies = 1\r\n\t\t\t\t\t\t\t// n.dishCopies = 1\r\n\t\t\t\t\t\t\tn.dishName = n.name\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.dishAddList = newArr\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$message.error(res.data.msg)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\r\n\t\t\t// 关键词收搜菜品列表分类\r\n\t\t\tgetDishForName(name) {\r\n\t\t\t\tqueryDishList({\r\n\t\t\t\t\tname\r\n\t\t\t\t}).then(res => {\r\n\t\t\t\t\tif (res.data.code === 1) {\r\n\t\t\t\t\t\tlet newArr = res.data.data\r\n\t\t\t\t\t\tnewArr.forEach((n) => {\r\n\t\t\t\t\t\t\tn.dishId = n.id\r\n\t\t\t\t\t\t\tn.dishName = n.name\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.dishAddList = newArr\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$message.error(res.data.msg)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\r\n\t\t\tcheckTypeHandle(ind, id) {\r\n\t\t\t\tthis.keyInd = ind\r\n\t\t\t\tthis.getDishList(id)\r\n\t\t\t},\r\n\r\n\t\t\tcheckedListHandle(value) {\r\n\t\t\t\tthis.getCheckList(this.checkedList)\r\n\t\t\t},\r\n\r\n\t\t\topen(done) {\r\n\t\t\t\tthis.dishListCache = JSON.parse(JSON.stringify(this.checkList))\r\n\t\t\t},\r\n\r\n\t\t\tclose(done) {\r\n\t\t\t\tthis.checkList = this.dishListCache\r\n\t\t\t},\r\n\r\n\t\t\t// 删除\r\n\t\t\tdelCheck(ind) {\r\n\t\t\t\tthis.checkedList.splice(ind, 1)\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t.addDish .el-input {\r\n\t\twidth: 130px;\r\n\t}\r\n\r\n\t.addDish .el-input-number__increase {\r\n\t\tborder-left: solid 1px #FFE1CA;\r\n\t\tbackground: #fff3ea;\r\n\t}\r\n\r\n\t.addDish .el-input-number__decrease {\r\n\t\tborder-right: solid 1px #FFE1CA;\r\n\t\tbackground: #fff3ea;\r\n\t}\r\n\r\n\t.addDish input {\r\n\t\tborder: 1px solid #ffe1ca;\r\n\t}\r\n\r\n\t.addDish .table {\r\n\t\tborder: solid 1px #EBEEF5;\r\n\t\tborder-radius: 3px;\r\n\t}\r\n\r\n\t.addDish .table th {\r\n\t\tpadding: 5px 0;\r\n\t}\r\n\r\n\t.addDish .table td {\r\n\t\tpadding: 7px 0;\r\n\t}\r\n\r\n\t.addDishList .seachDish {\r\n\t\tposition: absolute;\r\n\t\ttop: 10px;\r\n\t\tright: 20px;\r\n\t}\r\n\r\n\t.addDishList .el-dialog__body {\r\n\t\tpadding: 0;\r\n\t\tborder-bottom: solid 1px #ccc;\r\n\t}\r\n\r\n\t.addDishList .el-dialog__footer {\r\n\t\tpadding-top: 27px;\r\n\t}\r\n\r\n\t.addDish {\r\n\t\twidth: 777px;\r\n\t}\r\n\r\n\t.addDish .addBut {\r\n\t\tbackground: #ffc200;\r\n\t\tdisplay: inline-block;\r\n\t\tpadding: 0px 20px;\r\n\t\tborder-radius: 3px;\r\n\t\tline-height: 40px;\r\n\t\tcursor: pointer;\r\n\t\tborder-radius: 4px;\r\n\t\tcolor: #333333;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\r\n\t.addDish .content {\r\n\t\tbackground: #fafafb;\r\n\t\tpadding: 20px;\r\n\t\tborder: solid 1px #ccc;\r\n\t\tborder-radius: 3px;\r\n\t}\r\n\r\n\t.addDishCon {\r\n\t\tpadding: 0 20px;\r\n\t\tdisplay: flex;\r\n\t\tline-height: 40px;\r\n\t}\r\n\r\n\t.addDishCon .leftCont {\r\n\t\tdisplay: flex;\r\n\t\tborder-right: solid 2px #E4E7ED;\r\n\t\twidth: 60%;\r\n\t\tpadding: 15px;\r\n\t}\r\n\r\n\t.addDishCon .leftCont .tabBut {\r\n\t\twidth: 110px;\r\n\t}\r\n\r\n\t.addDishCon .leftCont .tabBut span {\r\n\t\tdisplay: block;\r\n\t\ttext-align: center;\r\n\t\tborder-right: solid 2px #f4f4f4;\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\t.addDishCon .leftCont .act {\r\n\t\tborder-color: #FFC200 !important;\r\n\t\tcolor: #FFC200 !important;\r\n\t}\r\n\r\n\t.addDishCon .leftCont .tabList {\r\n\t\tflex: 1;\r\n\t\tpadding: 15px;\r\n\t}\r\n\r\n\t.addDishCon .leftCont .tabList .table {\r\n\t\tborder: solid 1px #f4f4f4;\r\n\t\tborder-bottom: solid 1px #f4f4f4;\r\n\t}\r\n\r\n\t.addDishCon .leftCont .tabList .table .items {\r\n\t\tborder-bottom: solid 1px #f4f4f4;\r\n\t\tpadding: 0 10px;\r\n\t\tdisplay: flex;\r\n\t}\r\n\r\n\t.addDishCon .leftCont .tabList .table .items .el-checkbox,\r\n\t.addDishCon .leftCont .tabList .table .items .el-checkbox__label {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.addDishCon .leftCont .tabList .table .items .item {\r\n\t\tdisplay: flex;\r\n\t\tpadding-right: 20px;\r\n\t}\r\n\r\n\t.addDishCon .leftCont .tabList .table .items .item span {\r\n\t\tdisplay: inline-block;\r\n\t\ttext-align: center;\r\n\t\tflex: 1;\r\n\t}\r\n\r\n\t.addDishCon .ritCont {\r\n\t\twidth: 40%;\r\n\t\tpadding: 0 15px;\r\n\t}\r\n\r\n\t.addDishCon .ritCont .item {\r\n\t\tbox-shadow: 0px 1px 4px 3px rgba(0, 0, 0, 0.03);\r\n\t\tdisplay: flex;\r\n\t\ttext-align: center;\r\n\t\tpadding: 0 10px;\r\n\t\tmargin-bottom: 20px;\r\n\t\tborder-radius: 6px;\r\n\t\tcolor: #818693;\r\n\t}\r\n\r\n\t.addDishCon .ritCont .item span:first-child {\r\n\t\ttext-align: left;\r\n\t\tcolor: #20232A;\r\n\t}\r\n\r\n\t.addDishCon .ritCont .item .price {\r\n\t\tdisplay: inline-block;\r\n\t\tflex: 1;\r\n\t}\r\n\r\n\t.addDishCon .ritCont .item .del {\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\t.addDishCon .ritCont .item .del img {\r\n\t\tposition: relative;\r\n\t\ttop: 5px;\r\n\t\twidth: 20px;\r\n\t}\r\n\r\n\t.addDishCon .el-checkbox__label {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t#combo-add-app .setmealFood .el-form-item__label::before {\r\n\t\tcontent: '*';\r\n\t\tcolor: #F56C6C;\r\n\t\tmargin-right: 4px;\r\n\t}\r\n\r\n\t#combo-add-app .uploadImg .el-form-item__label::before {\r\n\t\tcontent: '*';\r\n\t\tcolor: #F56C6C;\r\n\t\tmargin-right: 4px;\r\n\t}\r\n</style>\n"]}]}